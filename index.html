<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
<title>Holiday Clock</title>

<style>
  :root{
    --bg: #000000;
    --fg: #ffffff;
    --shadow: rgba(0,0,0,0.55);
    --size-date: 42px;
    --size-time: 200px;
    --size-count: 40px;
    --size-today: 46px;
  }

  html,body{
    height:100%;
    margin:0;
    background:var(--bg);
    color:var(--fg);
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    -webkit-font-smoothing:antialiased;
    transition: background 1.2s ease, color 1.2s ease;
    overflow:hidden;
  }

  #root{
    position:relative;
    width:100%;
    height:100%;
    display:flex;
    align-items:center;
    justify-content:center;
  }

  .layout {
    z-index:2;
    display:flex;
    width:94%;
    height:92%;
    max-width:1200px;
    justify-content:center;
    align-items:center;
  }

  .text-block {
    width:100%;
    text-align:center;
    user-select:none;
    display:flex;
    flex-direction:column;
    align-items:center;
    justify-content:center;
  }

  #date, #countdown, #today {
    white-space: nowrap;
  }

  #date { font-size: var(--size-date); margin:0 0 8px 0; text-shadow:0 2px 10px var(--shadow); }
  #time { font-size: var(--size-time); margin:0; font-weight:700; text-shadow:0 6px 16px var(--shadow); }
  #countdown { font-size: var(--size-count); margin-top:10px; text-shadow:0 4px 10px var(--shadow); cursor:pointer; }
  #today { margin-top:10px; font-size: var(--size-today); font-weight:700; text-shadow:0 6px 14px var(--shadow); }

  .runner {
    position:absolute;
    bottom:6%;
    left:-30%;
    width:18vmin;
    z-index:9999;
    pointer-events:none;
    filter: drop-shadow(0 6px 8px rgba(0,0,0,0.45));
  }

  .sprite-run { background-repeat:no-repeat; background-size:cover; width:100%; height:100%; }

  @keyframes runAcross { 0%{ transform:translateX(-120%);} 100%{ transform:translateX(220%);} }
</style>
</head>

<body>
<div id="root">
  <div class="layout">
    <div class="text-block">
      <div id="date"></div>
      <div id="time"></div>
      <div id="countdown"></div>
      <div id="today"></div>
    </div>
  </div>
</div>

<script>
/* ============================
   Scaling Reference
============================ */
const REF_W = 480, REF_H = 320;
const BASE = { date:40, time:200, count:38, today:44 };

function applyScale(){
  const w = window.innerWidth;
  const h = window.innerHeight;
  let s = Math.min(w/REF_W, h/REF_H);
  s = Math.max(0.55, Math.min(s, 3.0));
  document.documentElement.style.setProperty('--size-date', BASE.date*s + 'px');
  document.documentElement.style.setProperty('--size-time', BASE.time*s + 'px');
  document.documentElement.style.setProperty('--size-count', BASE.count*s + 'px');
  document.documentElement.style.setProperty('--size-today', BASE.today*s + 'px');
}

/* ============================
   Holiday List
============================ */
const PRE_WINDOW = 14 * 24 * 60 * 60 * 1000;

const HOLIDAYS = [
  { key:"newyears",      name:"New Year's",         m:1, d:1 },
  { key:"valentine",     name:"Valentine's Day",    m:2, d:14 },
  { key:"stpatricks",    name:"St. Patrick's Day",  m:3, d:17 },
  { key:"easter",        name:"Easter",             m:null, d:"easter" },
  { key:"memorial",      name:"Memorial Day",       m:5, d:"lastMonday" },
  { key:"independence",  name:"4th of July",        m:7, d:4 },
  { key:"labor",         name:"Labor Day",          m:9, d:"firstMonday" },
  { key:"halloween",     name:"Halloween",          m:10, d:31 },
  { key:"thanksgiving",  name:"Thanksgiving",       m:11, d:"fourthThursday" },
  { key:"christmas",     name:"Christmas",          m:12, d:25 }
];

/* ============================
   TFT-SAFE COLOR THEMES
============================ */
const THEME = {
  thanksgiving: {
    backgrounds:["#F28C28","#D97904","#FFB347"],
    texts:["#FFF8E7","#FFFFFF","#FFE8C2"]
  },
  christmas:{
    backgrounds:["#8B0000","#0F4D1A","#004C3F"],
    texts:["#FFFFFF","#FFE8A3","#FFFAF2"]
  },
  newyears:{
    backgrounds:["#1A0033","#330066","#00111a"],
    texts:["#FFD700","#E8D6FF","#FFFFFF"]
  },
  valentine:{
    backgrounds:["#E63963","#FF8AAE","#FFC2D4"],
    texts:["#FFFFFF","#FFE6EE","#FFF5FA"]
  },
  stpatricks:{
    backgrounds:["#0B6E27","#1FA040","#3BD25B"],
    texts:["#FFFFFF","#E3FFD8","#F1FFEB"]
  },
  easter:{
    backgrounds:["#FFD6E8","#D9D4FF","#D1F7FF"],
    texts:["#6A3F99","#8F538D","#725679"]
  },
  halloween:{
    backgrounds:["#FF7A00","#CC5500","#FFA531"],
    texts:["#1A1A1A","#332222","#2A1200"]
  }
};

/* ============================
   Movable Holiday Calculations
============================ */
function easterDate(year){
  const a=year%19,b=Math.floor(year/100),c=year%100,d=Math.floor(b/4);
  const e=b%4,f=Math.floor((b+8)/25),g=Math.floor((b-f+1)/3);
  const h=(19*a+b-d-g+15)%30,i=Math.floor(c/4),k=c%4;
  const l=(32+2*e+2*i-h-k)%7,m=Math.floor((a+11*h+22*l)/451);
  const month=Math.floor((h+l-7*m+114)/31);
  const day=((h+l-7*m+114)%31)+1;
  return new Date(year,month-1,day);
}

function nthDay(year,month,weekday,n){
  const first=new Date(year,month,1).getDay();
  const day=1+((7+weekday-first)%7)+(n-1)*7;
  return new Date(year,month,day);
}

function lastWeekday(year,month,weekday){
  const last=new Date(year,month+1,0).getDay();
  const day=new Date(year,month+1,0).getDate()-((7+last-weekday)%7);
  return new Date(year,month,day);
}

function holidayDate(h,y){
  if(h.d==="easter") return easterDate(y);
  if(h.d==="fourthThursday") return nthDay(y,10,4,4);
  if(h.d==="firstMonday") return nthDay(y,8,1,1);
  if(h.d==="lastMonday") return lastWeekday(y,4,1);
  return new Date(y,h.m-1,h.d);
}

function getActiveHoliday(){
  const now=Date.now();
  const y=(new Date()).getFullYear();
  for(const h of HOLIDAYS){
    let dt=holidayDate(h,y);
    if(dt.getTime()+86400000 < now) dt = holidayDate(h,y+1);
    const start=dt.getTime()-PRE_WINDOW;
    const end=dt.getTime()+86400000;
    if(now>=start && now<=end) return {active:true,key:h.key,name:h.name,date:dt};
  }
  return {active:false};
}

/* ============================
   Color cycling
============================ */
let colorIndex=0;
let colorTimer=null;
const COLOR_MS=3000;

function applyThemeColors(key){
  if(!key || !THEME[key]){
    document.documentElement.style.setProperty('--bg','#000');
    document.documentElement.style.setProperty('--fg','#fff');
    return;
  }
  const T=THEME[key];
  const i=colorIndex % T.backgrounds.length;
  document.documentElement.style.setProperty('--bg',T.backgrounds[i]);
  document.documentElement.style.setProperty('--fg',T.texts[i]);
  colorIndex++;
}

function startColorCycle(key){
  if(colorTimer) clearInterval(colorTimer);
  if(!key){ applyThemeColors(null); return;}
  colorIndex=0;
  applyThemeColors(key);
  colorTimer=setInterval(()=>applyThemeColors(key),COLOR_MS);
}

/* ============================
   Clock + Countdown
============================ */
function updateClock(){
  const now=new Date();
  document.getElementById('date').textContent =
    now.toLocaleDateString(undefined,{weekday:"long",month:"long",day:"numeric"});
  document.getElementById('time').textContent =
    now.toLocaleTimeString([], {hour:"numeric",minute:"2-digit"}).replace(/ ?[AP]M?/i,"");

  const a=getActiveHoliday();
  const elC=document.getElementById('countdown');
  const elT=document.getElementById('today');

  if(a.active){
    const days=Math.floor((a.date-now)/86400000);
    if(days<=0){
      elT.textContent="Happy " + a.name + "!";
      elC.textContent="";
    } else {
      elT.textContent="";
      elC.textContent=days+" day"+(days!=1?"s":"")+" until "+a.name;
    }
  } else {
    elT.textContent="";
    elC.textContent="";
  }
}

/* ============================
   Runners
============================ */
const RUN_ASSETS=["-run.webp","-run.gif","-sprite.png"];
const RUNNERS={
  thanksgiving:["turkey"],
  christmas:["santa"],
  valentine:["cupid"],
  stpatricks:["leprechaun"],
  easter:["bunny"],
  halloween:["pumpkin"],
  independence:["rocket"],
  memorial:["flag"]
};

function pickRunner(key){
  const list=RUNNERS[key];
  if(!list||!list.length){
    return null;
  }
  return list[Math.floor(Math.random()*list.length)];
}

async function loadRunnerAsset(name){
  for(const suffix of RUN_ASSETS){
    const url="assets/"+name+suffix;
    const img=new Image();
    img.src=url;
    try{
      await img.decode();
      return {url, sprite: suffix.includes("sprite")};
    }catch{}
  }
  return null;
}

async function spawnRunner(key){
  if(!key) return;
  const name=pickRunner(key);
  if(!name) return;

  const asset=await loadRunnerAsset(name);
  if(!asset) return;

  const el=document.createElement('div');
  el.className='runner';
  el.style.animation=`runAcross 7s linear`;

  if(asset.sprite){
    const div=document.createElement('div');
    div.className='sprite-run';
    div.style.backgroundImage=`url('${asset.url}')`;
    div.style.backgroundSize='600% 100%';
    div.style.animation=`spriteAnim 0.8s steps(6) infinite`;
    el.appendChild(div);
  } else {
    const img=new Image();
    img.src=asset.url;
    img.style.width="100%";
    el.appendChild(img);
  }

  document.body.appendChild(el);
  el.addEventListener('animationend',()=>el.remove());
}

setInterval(()=>{
  const a=getActiveHoliday();
  if(a.active && Math.random()<0.3) spawnRunner(a.key);
}, 15000);

/* ============================
   Daily + Hourly Refresh
============================ */
function scheduleDaily(){
  const now=new Date();
  const next=new Date(now.getFullYear(),now.getMonth(),now.getDate()+1,0,5,0);
  setTimeout(()=>{ location.reload(); scheduleDaily(); }, next-now);
}
scheduleDaily();

setInterval(()=>location.reload(),3600000);

/* ============================
   Initialization
============================ */
applyScale();
updateClock();

window.addEventListener('resize',()=>setTimeout(applyScale,80));
setInterval(updateClock,1000);

(function() {
  const a=getActiveHoliday();
  startColorCycle(a.active ? a.key : null);
})();

/* ============================
   Manual Runner Trigger -- tap the countdown
============================ */
document.getElementById("countdown").addEventListener("click", () => {
  const a = getActiveHoliday();
  if (a.active) spawnRunner(a.key);
});
</script>
</body>
</html>
