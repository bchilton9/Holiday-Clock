<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1.0,user-scalable=no" />
<title>Holiday Clock â€” Themes + Runners</title>

<style>
  :root{
    --bg:#000000;
    --fg:#ffffff;
    --shadow: rgba(0,0,0,0.55);

    --size-date:42px;
    --size-time:200px;
    --size-count:40px;
    --size-today:46px;
  }

  html,body{
    height:100%;
    margin:0;
    background:var(--bg);
    color:var(--fg);
    font-family: system-ui, -apple-system, "Segoe UI", Roboto, sans-serif;
    overflow:hidden;
    -webkit-font-smoothing:antialiased;
    transition: background 1.3s ease, color 1.3s ease;
  }

  #root{
    width:100%;
    height:100%;
    display:flex;
    justify-content:center;
    align-items:center;
  }

  .layout{
    width:94%;
    height:92%;
    display:flex;
    justify-content:center;
    align-items:center;
  }

  .text-block{
    width:100%;
    text-align:center;
    display:flex;
    flex-direction:column;
    align-items:center;
  }

  #date,#countdown,#today{
    white-space:nowrap;
    overflow:hidden;
    text-overflow:ellipsis;
  }

  #countdown{
    cursor:pointer;
    text-decoration:underline;
  }

  #date{ font-size:var(--size-date); margin:0 0 8px 0; text-shadow:0 2px 10px var(--shadow); }
  #time{ font-size:var(--size-time); margin:0; line-height:0.9; font-weight:700; text-shadow:0 6px 16px var(--shadow); }
  #countdown{ font-size:var(--size-count); margin-top:10px; text-shadow:0 4px 10px var(--shadow); }
  #today{ font-size:var(--size-today); margin-top:10px; font-weight:700; text-shadow:0 6px 14px var(--shadow); }

  .runner{
    position:absolute;
    bottom:6%;
    left:-30%;
    width:20vmin;
    pointer-events:none;
    user-select:none;
    filter:drop-shadow(0 8px 10px rgba(0,0,0,0.45));
    will-change:transform,left;
  }

  .sprite-run{
    width:100%;
    height:100%;
    background-repeat:no-repeat;
    background-size:cover;
  }

  @keyframes runAcross{
    0%{ transform:translateX(-150%); }
    100%{ transform:translateX(250%); }
  }
</style>
</head>

<body>
<div id="root">
  <div class="layout">
    <div class="text-block">
      <div id="date"></div>
      <div id="time"></div>
      <div id="countdown"></div>
      <div id="today"></div>
    </div>
  </div>
</div>

<script>
/* ===============================
   CONFIG
   =============================== */

const REF_W = 480, REF_H = 320;

const BASE = {
  date:40,
  time:200,
  count:38,
  today:44
};

const PRE_WINDOW = 14 * 24 * 60 * 60 * 1000;

/* Holidays */
const HOLIDAYS = [
  { key:"newyears", name:"New Year's", m:1, d:1 },
  { key:"valentine", name:"Valentine's Day", m:2, d:14 },
  { key:"stpatricks", name:"St. Patrick's Day", m:3, d:17 },
  { key:"easter", name:"Easter", m:null, d:"easter" },
  { key:"memorial", name:"Memorial Day", m:5, d:"lastMonday" },
  { key:"independence", name:"4th of July", m:7, d:4 },
  { key:"labor", name:"Labor Day", m:9, d:"firstMonday" },
  { key:"halloween", name:"Halloween", m:10, d:31 },
  { key:"thanksgiving", name:"Thanksgiving", m:11, d:"fourthThursday" },
  { key:"christmas", name:"Christmas", m:12, d:25 }
];

/* Color themes (TFT-safe) */
const THEME = {
  valentine:{backgrounds:["#E63963","#FF8AAE","#FFC2D4"],texts:["#FFFFFF","#FFE6EE","#FFF5FA"]},
  stpatricks:{backgrounds:["#0B6E27","#1FA040","#3BD25B"],texts:["#FFFFFF","#E3FFD8","#F1FFEB"]},
  easter:{backgrounds:["#FFD6E8","#D9D4FF","#D1F7FF"],texts:["#6A3F99","#8F538D","#725679"]},
  memorial:{backgrounds:["#1F3A93","#3A62C9","#6A89CC"],texts:["#FFFFFF","#DCEBFF","#EAF4FF"]},
  independence:{backgrounds:["#0A1A59","#8B0000","#001133"],texts:["#FFFFFF","#FFCCCC","#DDE7FF"]},
  labor:{backgrounds:["#332E2E","#5A4B3A","#8A6E4C"],texts:["#FFFFFF","#FFEFD7","#FFF3E6"]},
  halloween:{backgrounds:["#FF7A00","#CC5500","#FFA531"],texts:["#1A1A1A","#331A00","#2A0F00"]},
  thanksgiving:{backgrounds:["#A66124","#C97A2C","#E89A4F"],texts:["#FFF7E6","#FFEFD7","#FFF1C9"]},
  christmas:{backgrounds:["#8B0000","#0F4D1A","#004C3F"],texts:["#FFFFFF","#FFE8A3","#FFFAF2"]},
  newyears:{backgrounds:["#1A0033","#330066","#00111A"],texts:["#FFD700","#FFFFFF","#E8D6FF"]}
};

/* Multiple runners per holiday */
const RUNNERS = {
  thanksgiving:["turkey"],
  christmas:["santa","reindeer","elf","tree"],
  newyears:["rocket","party"],
  valentine:["cupid"],
  stpatricks:["leprechaun"],
  easter:["bunny"],
  halloween:["pumpkin","ghost","skeleton"],
  independence:["rocket"],
  memorial:["flag"],
  labor:["worker"]
};

const RUNNER_FILES = ["-run.webp","-run.gif","-sprite.png"];

const COLOR_MS = 3000;
const RUN_MIN = 15000;
const RUN_MAX = 90000;
const RUN_TIME = 6;

/* ===============================
   DATE HELPERS
   =============================== */

function easterDate(y){
  const a=y%19,b=Math.floor(y/100),c=y%100,d=Math.floor(b/4),
  e=b%4,f=Math.floor((b+8)/25),g=Math.floor((b-f+1)/3),
  h=(19*a+b-d-g+15)%30,i=Math.floor(c/4),k=c%4,
  l=(32+2*e+2*i-h-k)%7,m=Math.floor((a+11*h+22*l)/451),
  month=Math.floor((h+l-7*m+114)/31),day=((h+l-7*m+114)%31)+1;
  return new Date(y,month-1,day);
}

function nthWeekdayOfMonth(y,month,weekday,n){
  const first=new Date(y,month,1);
  const adjust=(weekday-first.getDay()+7)%7;
  return new Date(y,month,1+adjust+(n-1)*7);
}
function lastWeekdayOfMonth(y,month,weekday){
  const last=new Date(y,month+1,0);
  const adjust=(last.getDay()-weekday+7)%7;
  return new Date(y,month,last.getDate()-adjust);
}

function holidayDate(h,y){
  if(h.d==="easter") return easterDate(y);
  if(h.d==="lastMonday") return lastWeekdayOfMonth(y,h.m-1,1);
  if(h.d==="firstMonday") return nthWeekdayOfMonth(y,h.m-1,1,1);
  if(h.d==="fourthThursday") return nthWeekdayOfMonth(y,10,4,4);
  return new Date(y,h.m-1,h.d);
}

function getActiveHoliday(){
  const now=Date.now();
  const year=(new Date()).getFullYear();
  for(const h of HOLIDAYS){
    let d=holidayDate(h,year);
    if(d.getTime() < now - 86400000) d=holidayDate(h,year+1);
    const start=d.getTime()-PRE_WINDOW;
    const end=d.getTime()+86400000;
    if(now>=start && now<=end)
      return {active:true,key:h.key,name:h.name,date:d};
  }
  return {active:false};
}

/* ===============================
   UI + AUTOSCALE
   =============================== */

const elDate=document.getElementById("date");
const elTime=document.getElementById("time");
const elCount=document.getElementById("countdown");
const elToday=document.getElementById("today");

function applyScale(){
  const w=window.innerWidth,h=window.innerHeight;
  let s=Math.min(w/REF_W,h/REF_H);
  s=Math.max(0.55,Math.min(s,3));
  document.documentElement.style.setProperty("--size-date",BASE.date*s+"px");
  document.documentElement.style.setProperty("--size-time",BASE.time*s+"px");
  document.documentElement.style.setProperty("--size-count",BASE.count*s+"px");
  document.documentElement.style.setProperty("--size-today",BASE.today*s+"px");
}

function updateClock(){
  const now=new Date();
  elDate.textContent=now.toLocaleDateString(undefined,{weekday:"long",month:"long",day:"numeric"});
  let t=now.toLocaleTimeString([], {hour:"numeric",minute:"2-digit"});
  elTime.textContent=t.replace(/ ?[AP]M/i,"");

  const a=getActiveHoliday();
  if(a.active){
    const diff=a.date-now;
    const days=Math.floor(diff/(1000*60*60*24));
    if(days<=0){
      elToday.textContent="Happy "+a.name+"!";
      elCount.textContent="";
    } else {
      elToday.textContent="";
      elCount.textContent=`${days} days until ${a.name}`;
    }
  } else {
    elToday.textContent="";
    elCount.textContent="";
  }
}

/* ===============================
   COLOR CYCLING
   =============================== */

let colorIndex=0;
let colorTimer=null;

function applyTheme(key){
  if(!key||!THEME[key]){
    document.documentElement.style.setProperty("--bg","#000");
    document.documentElement.style.setProperty("--fg","#fff");
    return;
  }
  const p=THEME[key];
  const i=colorIndex%p.backgrounds.length;
  document.documentElement.style.setProperty("--bg",p.backgrounds[i]);
  document.documentElement.style.setProperty("--fg",p.texts[i]);
  colorIndex++;
}

function startTheme(key){
  if(colorTimer) clearInterval(colorTimer);
  if(!key){
    applyTheme(null);
    return;
  }
  colorIndex=0;
  applyTheme(key);
  colorTimer=setInterval(()=>applyTheme(key),COLOR_MS);
}

/* ===============================
   RUNNER LOGIC
   =============================== */

let runnerTimer=null;

function rand(min,max){return Math.floor(Math.random()*(max-min))+min;}

function pickRunner(key){
  const list=RUNNERS[key]||[];
  if(list.length===0) return null;
  return list[Math.floor(Math.random()*list.length)];
}

async function loadRunnerAsset(name){
  for(const ext of RUNNER_FILES){
    const url=`assets/${name}${ext}`;
    let ok=await checkAsset(url);
    if(ok) return {url,type: ext.includes("sprite")?"sprite":"img"};
  }
  return null;
}

function checkAsset(url){
  return new Promise(res=>{
    const img=new Image();
    img.onload=()=>res(true);
    img.onerror=()=>res(false);
    img.src=url;
  });
}

async function spawnRunner(key){
  if(!key) return;

  if(Math.random()<0.4) return scheduleRunner();

  const name=pickRunner(key);
  if(!name) return;

  const asset=await loadRunnerAsset(name);
  if(!asset) return scheduleRunner();

  const el=document.createElement("div");
  el.className="runner";

  const vw=window.innerWidth;
  const size=Math.max(60,Math.min(200,Math.round(vw*0.18)));
  el.style.width=size+"px";

  if(asset.type==="img"){
    const img=new Image();
    img.src=asset.url;
    img.style.width="100%";
    el.appendChild(img);
  } else {
    const sprite=document.createElement("div");
    sprite.className="sprite-run";
    sprite.style.backgroundImage=`url(${asset.url})`;
    sprite.style.backgroundSize="600% 100%";
    const frames=6;

    const anim=`sprite_${Date.now()}`;
    const style=document.createElement("style");
    style.textContent=`@keyframes ${anim}{100%{background-position:-${(frames-1)*100}% 0}}`;
    document.head.appendChild(style);

    sprite.style.animation=`${anim} 0.7s steps(${frames}) infinite`;
    el.appendChild(sprite);
  }

  document.body.appendChild(el);

  el.style.animation=`runAcross ${RUN_TIME}s linear`;
  el.addEventListener("animationend",()=>el.remove());

  scheduleRunner();
}

function scheduleRunner(){
  if(runnerTimer) clearTimeout(runnerTimer);
  const a=getActiveHoliday();
  if(!a.active){runnerTimer=null;return;}
  runnerTimer=setTimeout(()=>spawnRunner(a.key),rand(RUN_MIN,RUN_MAX));
}

/* ===============================
   CLICK-TO-RUN SUPPORT
   =============================== */

elCount.addEventListener("click",()=>{
  const a=getActiveHoliday();
  if(a.active) spawnRunner(a.key);
});

/* ===============================
   MAIN LOOP
   =============================== */

let prevKey=null;

function mainTick(){
  updateClock();
  const a=getActiveHoliday();
  if(a.active){
    if(prevKey!==a.key){
      prevKey=a.key;
      startTheme(a.key);
      scheduleRunner();
    }
  } else {
    if(prevKey!==null){
      prevKey=null;
      startTheme(null);
    }
  }
}

/* start */
applyScale();
updateClock();
mainTick();

setInterval(updateClock,1000);
setInterval(mainTick,3000);

window.addEventListener("resize",()=>setTimeout(applyScale,80));
window.addEventListener("orientationchange",()=>setTimeout(applyScale,200));

/* expose for console debugging */
window.__clock={
  runNow:()=>{const a=getActiveHoliday();if(a.active)spawnRunner(a.key);},
  getHoliday:getActiveHoliday
};
</script>

</body>
</html>
